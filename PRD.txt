Product Requirements Document (PRD)
===================================

1. 개요
-------
본 프로젝트는 단일 바이너리 형태로 배포되는 로컬 TUI 기반
리소스 모니터링 및 집계 도구이다.
Go 언어로 구현되며 tview를 사용한 터미널 UI를 제공한다.
설정은 YAML 파일 기반으로 관리하며, 실행 시 외부 의존성 없이
독립적으로 동작하는 것을 목표로 한다.

2. 목표
-------
- 서버/노드 단위의 리소스 사용량을 주기적으로 수집
- 수집된 리소스를 명시적인 집계 규칙에 따라 계산
- 집계 결과를 SQLite에 영속 저장
- TUI 화면을 통해 실시간 및 집계 정보를 조회
- 프로세스 재시작 시에도 상태 복구 가능

3. 비목표 (Out of Scope)
------------------------
- 분산 클러스터 간 통합 집계
- 원격 전송(HTTP, gRPC, Kafka 등)
- 플러그인/확장 시스템 (추후 고려)

4. 시스템 아키텍처
------------------
- Language: Go (>=1.22)
- UI: tview (TUI)
- Config: YAML
- Storage: SQLite (필수)
- Distribution: 단일 바이너리

5. 설정 관리
------------
- 모든 설정은 YAML 파일로 관리
- 포함 항목:
  - 수집 주기 (interval)
  - 리소스 종류 (CPU, Memory, Disk 등)
  - 집계 윈도우 (예: 1m, 5m, 1h)
- 런타임 중 설정 변경은 지원하지 않음

6. 리소스 수집 및 집계 방식
--------------------------
[수집]
- 각 리소스는 설정된 주기에 따라 raw 값으로 수집
- raw 데이터는 메모리에만 존재하며 SQLite에는 저장하지 않음

[집계]
- 집계는 명시적인 윈도우 기반으로 수행
- 기본 집계 함수:
  - AVG
  - MAX
  - MIN
  - LAST
- 집계 완료 시점에만 SQLite에 기록

[저장 구조]
- timestamp (window end)
- resource_type
- metric_name
- aggregated_value

7. SQLite 설계
--------------
- SQLite는 필수 구성요소
- 용도:
  - 집계 결과 영속화
  - 마지막 수집/집계 시각 저장
  - 재시작 시 상태 복구
- CGO 없는 드라이버 사용 (예: modernc.org/sqlite)
- WAL 모드 활성화 고려

8. TUI 요구사항
---------------
- 실시간 리소스 화면
- 집계 결과 조회 화면
- 키보드 기반 네비게이션
- 마우스 입력 비필수

9. 배포 방식
------------
- 단일 실행 파일로 배포
- 외부 런타임 의존성 없음
- Linux 우선 지원 (Windows/MacOS 차후 고려)

10. 테스트 전략
---------------
- Unit Test
  - 집계 로직
  - SQLite DAO
- Integration Test
  - 수집 → 집계 → 저장 흐름
- Load Test
  - 고주기 수집 시 CPU/Memory 영향
  - SQLite write 부하 검증

11. 성능 및 제약
----------------
- 장시간 실행(수 주 이상)을 전제로 메모리 누수 없음
- SQLite 파일 크기 증가에 대한 정책은 추후 정의

12. 향후 확장 고려사항
---------------------
- Exporter (Prometheus, JSON)
- 원격 API
- 플러그인 기반 수집기
